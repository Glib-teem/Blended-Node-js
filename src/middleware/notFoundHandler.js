// Middleware для обробки запитів до неіснуючих маршрутів (404 Not Found)

// notFoundHandler - це middleware який спрацьовує
// Жоден з визначених роутів не збігся з URL запиту
// Клієнт звертається до неіснуючого endpoint

// Цей middleware має бути розміщений:
// ПІСЛЯ всіх роутів (щоб спрацьовувати тільки якщо нічого не збіглося)
// ПЕРЕД errorHandler (щоб не перекривати обробку інших помилок)

// MIDDLEWARE ДЛЯ ОБРОБКИ 404

// Спрацьовує коли:
// URL не співпадає з жодним зареєстрованим роутом
// Метод не підтримується для даного URL

const notFoundHandler = (req, res, next) => {
  // ЛОГУВАННЯ логую інформацію про неіснуючий маршрут - для відладки та моніторингу

  console.warn('⚠️  404 Not Found:');
  console.warn('Method:', req.method); // GET, POST, PATCH, DELETE тощо
  console.warn('URL:', req.originalUrl); // Повний URL з query параметрами
  console.warn('IP:', req.ip); // IP адреса клієнта
  console.warn('User-Agent:', req.get('user-agent')); // Браузер/клієнт

  // ВІДПРАВКА ВІДПОВІДІ КЛІЄНТУ

  // Встановлюю статус код 404 (Not Found) - ресурс не знайдено, маршрут не існує
  res.status(404).json({
    message: 'Route not found',
  });
};

module.exports = notFoundHandler;

// BEST PRACTICES

/*
1. Завжди розміщуй notFoundHandler ПІСЛЯ всіх роутів

2. Використовуй 404 тільки для:
   - Неіснуючих маршрутів (notFoundHandler)
   - Неіснуючих ресурсів (продукт не знайдено в БД)

3. Логуй 404 помилки для аналізу:
   - Виявлення битих посилань
   - Моніторинг спроб несанкціонованого доступу

4. В API відповіді використовуй JSON, не HTML

5. Надавай корисну інформацію користувачу:
   - Список доступних endpoint
   - Посилання на документацію
   - Контактна інформація служби підтримки

6. Не розкривай чутливу інформацію в повідомленнях про помилки

7. Тестуй 404 помилки в різних сценаріях
*/
